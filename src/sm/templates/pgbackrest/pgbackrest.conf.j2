# pgBackRest Configuration
# Generated by sm postgres setup
# S3-compatible backup to {{ s3_bucket }}

[global]
repo1-type=s3
repo1-path={{ repo_path }}
repo1-s3-bucket={{ s3_bucket }}
repo1-s3-endpoint={{ s3_endpoint }}
repo1-s3-region={{ s3_region }}
repo1-s3-key={{ s3_key }}
repo1-s3-key-secret={{ s3_secret }}
repo1-s3-uri-style=path

# Performance & storage tuning
start-fast=y
process-max={{ process_max }}
compress-type=lz4
compress-level=3
repo1-block=y
repo1-bundle=y

# Retention policy
repo1-retention-full={{ retention_full }}
repo1-retention-archive={{ retention_archive }}

# Encryption at rest
repo1-cipher-type=aes-256-cbc
repo1-cipher-pass="cat {{ passphrase_file }}"

[{{ stanza }}]
pg1-path={{ pg_data_path }}
pg1-user=postgres
